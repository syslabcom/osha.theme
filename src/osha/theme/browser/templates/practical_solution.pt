<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

  <metal:block tal:define="dummy python:request.RESPONSE.setHeader('Cache-control', 'max-age=0,s-maxage=3600')" />

  <body>
    <div metal:fill-slot="main">

      <span tal:define="keyword view/get_keyword;
                        subcategory request/subcategory | string:;
                        object_implements request/object_implements | string:;
                        SearchableText request/SearchableText|string:;
                        multilingual_thesaurus request/multilingual_thesaurus|string:;
                        nace request/nace|string:;
                        nace python:nace==[''] and '' or nace;
                        category request/category|string:;
                        getRemoteLanguage request/getRemoteLanguage|string:;
                        country request/country|string:;
                        search_portal_types view/search_portal_types;
                        Batch python:modules['Products.CMFPlone'].Batch;
                        DateTime python:modules['DateTime'].DateTime;
                        b_size python:10;b_start python:0;
                        b_start request/b_start | b_start;
                        desc_length site_properties/search_results_description_length;
                        desc_ellipsis site_properties/ellipsis;
                        searchterm request/SearchableText|nothing;
                        ">

        <h1  class="documentFirstHeading" tal:content="context/Title">Title</h1>

        <div class="photoAlbum">
          <div class="photoAlbumEntry photoAlbumFolder">

            <span class="photoAlbumEntryWrapperWrapper"
                  tal:condition="view/has_section_image">
              <span class="photoAlbumEntryWrapper">
                <img width="84" title="Section Title"
                     alt="Section Alt" src="../section-image.png"
                     tal:attributes="alt context/aq_parent/Title;
                                     title context/aq_parent/Title" />
              </span>
              <span class="photoAlbumEntryTitle database-emphasis"
                    tal:content="context/aq_parent/Title">
                Section Title
              </span>
            </span>

          </div>
        </div>

        <metal:field use-macro="python:context.widget('text', mode='view')">
          Body text
        </metal:field>

        <br clear="all">

        <form id="database_search"
              tal:attributes="action template/id" method="get">

          <div id="filter_searchfields">

           <h1 tal:content="view/get_i18n_database_search_heading"
                >Search in the Risk Assessment Database
            </h1>

            <div class="field_default">
              <input type="text"
                     id="SearchableText"
                     name="SearchableText"
                     size="40"
                     tal:attributes="value request/SearchableText|nothing"
                     />
            </div>

            <dl id="image-controls" class="collapsible inline collapsedOnLoad"
                tal:attributes="class view/get_collapsed_css">
              <dt class="collapsibleHeader"
                  i18n:translate="action_advanced_search">Advanced search</dt>

              <dd class="collapsibleContent">
                <div class="formHelp">
                  Filter your search by selecting one or more of
                  the filters.  You can always remove any filter
                  again by selecting the empty entry or by
                  clicking the Reset button.
                </div>

                <div class="filter_column1">

                  <div class="field">
                    <label
                       i18n:translate="label_database"> Database </label><br />

                    <div class="formHelp"
                         i18n:translate="help_database_search">
                      Select the database types you want to search.
                    </div>

                    <div tal:repeat="T view/search_types">
                      <input class="input_checkbox" type="checkbox"
                             name="search_portal_types:list"
                             tal:attributes="value python:T[1];
                                             checked python: 'checked' and T[2] or ''" />
                      <span tal:content="python:T[0]" ></span>
                    </div>

                    <div class="field_default">
                      <metal:use use-macro="context/filter_macros/macros/RemoteLanguage_compact"></metal:use>
                    </div>

                    <div class="field_default" tal:define="value country">
                      <metal:use use-macro="context/filter_macros/macros/MultiCountry_compact"></metal:use>
                    </div>
                  </div>

                </div>

                <div class="filter_column2">

                  <div class="field_default"
                       tal:define="value keyword; size python: 1">

                    <span tal:attributes="class python:value and 'hiddenStructure' or ''">
                      <metal:use use-macro="here/filter_macros/macros/Subject"></metal:use>
                    </span>


                    <tal:has_categories condition="keyword">
                      <label>
                        Category: <tal:categories
                                       content="keyword">
                        </tal:categories>
                      </label>
                      <div class="field_default"
                           tal:define="root_node   keyword;
                                       vocabulary  string:Subcategory;
                                       value       subcategory;
                                       fieldName   string:subcategory;">
                        <label
                           i18n:translate="label_subcategory"
                           >Subcategory
                        </label><br />
                        <metal:use use-macro="context/filter_macros/macros/ATVocabularyDropdown"></metal:use>
                      </div>
                    </tal:has_categories>

                  </div>

                  <div class="field_vocab"
                       tal:define="level python:2;
                                   portal_type string:OSH_Link">
                    <metal:use use-macro="context/filter_macros/macros/NACE"></metal:use>
                  </div>

                  <div class="field_vocab"
                       tal:define="portal_type string:OSH_Link">
                    <metal:use use-macro="context/filter_macros/macros/MultilingualThesaurus"></metal:use>
                  </div>

                </div>
                <div class="visualClear"></div>

              </dd>

            </dl>

            <div class="formControls">
              <input class="context"
                     type="submit"
                     name="submit"
                     value="Search"
                     i18n:domain="plone"
                     i18n:attributes="value label_search;"
                     />
              <input  class="context" type="reset" value="Reset"
                      tal:attributes="onclick string:window.location='${context/absolute_url}/${template/getId}'" />

            </div>
          </div>
        </form>

        <div tal:define="results view/search">

          <!--i>Filtered by:
          <span tal:replace="view/buildQuery"></span>
          </i-->

          <h2>
            <span i18n:translate="heading_search_results">
              Search results
            </span>
            <span class="discreet">
              &mdash;
              <span i18n:translate="batch_x_items_matching_your_criteria"
                    ><tal:number i18n:name="number"
                                 content="python:len(results)"
                                 >234 </tal:number>
              </span> items matching your search terms
            </span>
          </h2>

          <div tal:condition="not: results">
            <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
          </div>

          <div tal:condition="results"
               tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

            <dl id="db_results">
              <tal:results repeat="result batch">
                <tal:entry define="provider_helper context/@@provider_helper;
                                   result_url result/getURL;
                                   url result/getRemoteUrl | result_url;
                                   title result/Title|string:;
                                   item_cas result/getCas|string:;
                                   item_einecs result/getEinecs|string:;
                                   item_remoteLanguage result/getRemoteLanguage|string:;
                                   item_subject result/Subject | python:[];
                                   item_modified result/modified;
                                   item_pubdate result/effective;
                                   item_creator result/Creator;
                                   gc python:context.portal_languages.getNameForLanguageCode;
                                   ">

                  <metal:macro use-macro="context/oshmacros/macros/searchresults" />

                </tal:entry>
              </tal:results>
            </dl>

            <div class="visualClear" ></div>

            <div metal:use-macro="context/batch_macros/macros/navigation" />

            <!-- Snapshot code -->
            <script type="text/javascript" src="http://shots.snap.com/ss/8c2016f0b237f14c8e18548d26c3d103/snap_shots.js"></script>
          </div>

        </div>

      </span>

    </div>
  </body>
</html>
