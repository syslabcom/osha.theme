<metal:page define-macro="master">
  <metal:doctype define-slot="doctype">
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  </metal:doctype>
  <metal:block use-macro="here/global_defines/macros/defines" />
  <metal:block tal:define="charset here/site_properties/default_charset|string:utf-8; dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % charset)" />

  <html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:v="urn:schemas-microsoft-com:vml"
        xml:lang="en"
        lang="en"
        tal:attributes="lang site_properties/default_language|default;
                        xml:lang site_properties/default_language|default;">

    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"
            tal:define="charset site_properties/default_charset|string:utf-8"
            tal:attributes="content string:text/html;;charset=${charset}" />

      <title tal:define="portal_title here/portal_properties/title;
                         here_title here/Title | here/title | here/id;
                         template_title python:template.title_or_id();
                         here_title python:test( portal_title != here_title,
                         here_title,
                         template_title )"
             tal:content="structure string:$portal_title - $here_title">Title of page</title>


      <meta tal:condition="here/listMetaTags|nothing"
            tal:repeat="keyval here/listMetaTags"
            tal:attributes="name python:keyval[0];
                            content python:keyval[1];" />

      <style type="text/css" tal:define="sheet python:getattr(here.portal_url.getPortalObject(), 'oshmail.css')" tal:content="structure sheet"></style>
    </head>

    <body leftmargin="5"
          tal:define="plone_view context/@@plone;
                      view nocall:view | nocall: plone_view;
                      ltool nocall:here/portal_languages;
                      propstool nocall:here/portal_properties;
                      site_props nocall:propstool/site_properties;
                      prefLang python: request.get('set_language', 'en');
                      oshaview here/@@oshaview;
                      collage_id here/getId;
                      body_class python:plone_view.bodyClass(template, view);"
          tal:attributes="class body_class;">

      <table id="oshmail-wrapper">
        <tr>
          <td>
            <background></background>
            <table id="headertable"
                   tal:attributes="background string:${context/portal_url}/en/news/oshmailheaderbackground.jpg">
              <tr>
                <td class="col1">
                  <a href="#" accesskey="1"
                     tal:attributes="href string:${context/portal_url}"
                     target="_blank">&nbsp;</a>
                </td>
                <td class="col2">
                  <h1 class="documentFirstHeading"><span tal:replace="here/title_or_id" /><br/>Newsletter</h1><br/>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td>
            &nbsp;
            <table id="language-list-wrapper">
              <tr>
                <td valign="top"
                    tal:define="lang_info ltool/getAvailableLanguageInformation;">
                  <tal:block define="supported_languages ltool/listSupportedLanguages|python:[];
                                     languages_on_main_site site_props/languages_on_main_site|python:[];
                                     served_language_keys python:[x[0] for x in supported_languages if x[0] in languages_on_main_site];
                                     served_languages python:oshaview.get_sorted(served_language_keys);"
                             condition="python:len(served_languages)>1">
                    <div id="language-list" i18n:domain="osha"
                         tal:define="thisurl string:${here/absolute_url}/${template/id}">

                      <span tal:omit-tag="" tal:repeat="lang served_languages">
                        <a tal:omit-tag="python:prefLang == lang"
                           tal:define="lang_url python:thisurl+'?set_language='+lang;
                                       url python:oshaview.handleOSHMailUrls(lang_url, collage_id);"
                           href="" tal:attributes="href url"
                           tal:content="python:oshaview.get_native_language_by_code(lang)">
                          lang</a>
                        <span tal:omit-tag="" tal:condition="not:repeat/lang/end"> | </span> </span>
                    </div>
                  </tal:block>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td>
            <metal:bodytext metal:define-slot="main" tal:content="nothing">
              <!-- Page body text -->
            </metal:bodytext>
          </td>
        </tr>
      </table>
    </body>
  </html>
</metal:page>
