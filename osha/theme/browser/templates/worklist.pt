<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<metal:cssslot fill-slot="css_slot"
               tal:define="global mockup here/@@ATMockup;
                           dummy python:mockup.preload(types=[('OSH_Link', 'OSHContentLink')]);">
  <!--style type="text/css" media="all" tal:condition="exists: portal/riskassessment_styles.css"
         tal:content="string:@import url($portal_url/riskassessment_styles.css);">
  </style-->
  <!--style type="text/css">
    .column1 { float: left; width: 55%; padding-right: 10px; }
    .column2 { float: right; width: 40%; padding-left: 10px; border-left: 1px dotted gray; }
    
    .column1 select,
      .column2 li  { width: 100%; }
    .column2 .field_default, 
    .column2 .field_vocab { width: 100%; padding: 2px 0; }
    .column2 .field_vocab input { width: 50%; }
    .column2 .field_vocab .searchButton { width: 20%; }
    .column2 input[type="checkbox"] { vertical-align: left; width: 5%;}
    .column2 .field_default input, 
    .column2 .field_default select { width: 100%; }

    
    #wf_results { width: 100%; margin-top: 2em; }
    #wf_results th { background-color: #C5CBD8; border-bottom: 1px dotted gray; padding: 3px; }
    #wf_results td { background-color: transparent; border-bottom: 1px dotted gray; padding: 3px; }
    .fieldRequired  {visibility: hidden}

    .column1 input.input_checkbox, #multilingual_thesaurus li label input,
        #nace li label input { width: 1.2em; border: none; background: transparent; padding: 0; }
    
  </style-->

</metal:cssslot>

<metal:javascriptslot fill-slot="javascript_head_slot">
  <script language="JavaScript">
  function resetSize(aSelect) {
    if(aSelect) {
      aSelect.style.width = 'auto';
    }
  }
  </script>

  <tal:js define="js python:here.getUniqueWidgetAttr(mockup.getFields(), 'helper_js')"
          condition="js"
          repeat="item js">
    <script type="text/javascript"
            charset="iso-8859-1"
            tal:condition="python:exists('portal/%s' % item)"
            tal:attributes="src string:$portal_url/$item">
    </script>
  </tal:js>
</metal:javascriptslot>

<div metal:fill-slot="main" i18n:domain="osha"
       tal:define="keywords request/keywords|string:;
                   SearchableText request/SearchableText|string:;
                   nace request/nace|string:;
                   multilingual_thesaurus request/multilingual_thesaurus|string:;
                   subcategory request/subcategory|string:;
                   getRemoteLanguage request/getRemoteLanguage|string:;
                   country request/country|string:;
                   search_portal_types view/search_portal_types;
                   review_state request/review_state|string:;
                   Creator request/Creator|member/getName|member/getUserName|string:;
                   getRemoteUrl request/getRemoteUrl|string:;
                   Batch python:modules['Products.CMFPlone'].Batch;
                   DateTime python:modules['DateTime'].DateTime;
                   b_size python:10;b_start python:0;
                   b_start request/b_start | b_start;
                   desc_length site_properties/search_results_description_length;
                   desc_ellipsis site_properties/ellipsis;
                   searchterm request/SearchableText|nothing;
                   ">


    
    <h1 class="documentFirstHeading">Worklist</h1>
    <div>
        <p>Please use these fields to select workitems.</p>
    </div>

    <form tal:attributes="action template/id" method="get">
    
      <div id="filter_searchfields">
      
         <div class="filter_column1">
            <div class="field_default">
                <metal:use use-macro="here/filter_macros/macros/SearchableText_compact"></metal:use>
            </div>
            <div class="columnBottom field">
             <div class="formHelp">
                Filter your search by selecting one or more of the filters.
                You can always remove any filter again by selecting the empty entry or by clicking the Reset button.
             </div>

            </div>
            
            <div class="field_default" 
                 tal:define="size python:6;
                    wfname string:osh_workflow">
              <metal:use use-macro="here/filter_macros/macros/ReviewState_compact"></metal:use>
            </div>
            
            <div class="field">
                <label i18n:translate="label_database"> Database </label><br>
                
                <div class="formHelp" i18n:translate="help_database_search">
                    Select the database types you want to search.
                </div>

                <div tal:repeat="T view/search_types">
                    <input class="input_checkbox" type="checkbox" 
                           name="search_portal_types:list"
                           tal:attributes="value python:T[1];
                                           checked python: 'checked' and T[2] or ''" />
                    <span tal:content="python:T[0]" />
                </div>
            </div>
                        
          </div>
          
          <div class="filter_column2">
            <!--div class="columnTop field">
              <label i18n:translate="label_search_filters">Filters</label>
            </div-->

            <div class="field_default">
               <metal:use use-macro="here/filter_macros/macros/Author_compact"></metal:use>
            </div> 
             <div class="field_default" 
                tal:define="portal_type string:OSH_Link;
                    value country">
              <metal:use use-macro="here/filter_macros/macros/Country_compact"></metal:use>
            </div>
            <div class="field_default">
                <metal:use use-macro="here/filter_macros/macros/RemoteLanguage_compact"></metal:use>
            </div>
            <div class="field_default">
               <metal:use use-macro="here/filter_macros/macros/RemoteUrl_compact"></metal:use>
            </div> 
            <div class="field_vocab">
               <metal:use use-macro="here/filter_macros/macros/Subcategory"></metal:use>
            </div>
            <div class="field_vocab">
               <metal:use use-macro="here/filter_macros/macros/NACE"></metal:use>
            </div>
            <div class="field_vocab">
               <metal:use use-macro="here/filter_macros/macros/MultilingualThesaurus"></metal:use>
            </div>
          </div>

        </div>
       
        <br clear="all">
        
        <div class="formControls">
          <input class="context" type="submit" value="Search" />
          <input  class="context" type="reset" value="Reset" 
                    tal:attributes="onclick string:window.location='${here/absolute_url}/${template/getId}?Creator='" />
        </div>
        
    </form>
    <br clear="all"><br>
    
     <div tal:define="query view/buildQuery;
                  results python:here.portal_catalog(query);">

        <!-- query: <span tal:replace="query" /> -->

        <h2>
          <span i18n:translate="heading_search_results">
              Search results
          </span>
          <span class="discreet">
          &mdash;
          <span i18n:translate="batch_x_items_matching_your_criteria"
          ><span i18n:name="number" 
          tal:omit-tag="" 
          tal:content="python:len(results)">234</span> items matching your search terms</span>
      </h2>

        <div tal:condition="not: results">
            <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
        </div>

    <div tal:condition="results"
         tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">
        
        <dl id="db_results">
        <tal:results repeat="result batch">
        <tal:entry define="provider_helper here/@@provider_helper;
                           result_url result/getURL;
                           url result/getRemoteUrl | result_url;
                           title result/Title|string:;
                           item_remoteLanguage result/getRemoteLanguage|string:;
                           item_subject result/Subject | python:[];
                           item_modified result/modified;
                           item_pubdate result/effective;
                           item_creator result/Creator;
                           gc python:here.portal_languages.getNameForLanguageCode;
                           ">
            
            <metal:macro use-macro="here/oshmacros/macros/searchresults" />

        </tal:entry>
        </tal:results>
        </dl>
        
        <div metal:use-macro="here/batch_macros/macros/navigation" />

        <!-- Snapshot code -->
        <script type="text/javascript" src="http://shots.snap.com/ss/9546198046d69719d86ad9ba1aee068e/snap_shots.js"></script>
    </div>

    </div>
  </div>

</html>

