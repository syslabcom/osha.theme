<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="osha">


<div metal:fill-slot="main" i18n:domain="osha"
       tal:define="Subject string:msd;
                   resultsByKeyword python:view.resultsByKeyword(Subject=Subject);
                   resultsByLetter view/resultsByLetter;
                   resultsByTermId view/resultsByTermId;
                   resultsList python:resultsByLetter[0];
                   resultsMap python:resultsByLetter[1];
                   letter request/letter | view/getLetter |string:;
                   term_id request/term_id | view/getTerm_id |string:;
                   Batch python:modules['Products.CMFPlone'].Batch;
                   DateTime python:modules['DateTime'].DateTime;
                   b_size python:10;b_start python:0;
                   b_start request/b_start | b_start;
                   desc_length site_properties/search_results_description_length;
                   desc_ellipsis site_properties/ellipsis;
                   ">

  <style type="text/css">
  #db_results dd { background-color: transparent; margin-left: 0; padding-left: 2em !important; border-bottom: 1px dotted gray; padding: 2px; } 
  </style>

    <div>
        <h1 class="documentFirstHeading">Index A-Z: <span tal:content="Subject" i18n_translate=""/> </h1>

        <div style="text-align:center" tal:define="alphabet view/getAlphabet; 
                         ">
            <span tal:repeat="alpha alphabet">
                
                <a href="" 
                   tal:attributes="href string:${request/URL}?Subject=${Subject}&letter=${alpha}"
                   tal:condition="python:resultsByKeyword.get(alpha, None)">                
                    <strong style="font-size: larger" tal:content="alpha" />
                </a>
                
                <span tal:condition="python:not resultsByKeyword.get(alpha, None)" tal:content="alpha"/> 
                
                <span tal:omit-tag="" tal:condition="not:repeat/alpha/end">|</span> 
            
            </span>
            
        </div>    



        <div tal:condition="view/getLetter">
            <h2>
                <span tal:content="view/getLetter">Letter</span>
            </h2>
            <ul>
                <li tal:repeat="key resultsList"> 
                    <a tal:define="term_id python:view.getIdByCaption(key)"
                       tal:content="python:'%s (%s)' %(key, len(resultsMap.get(key, [])) ) "
                       tal:attributes="href string:${request/URL}?Subject=${Subject}&letter=${letter}&term_id=${term_id}"/>
                </li>
            </ul>
        </div>    
        
        
        
        
        <div tal:condition="resultsByTermId">        

            <h2>
                <span i18n:translate="heading_search_results">
                    Search results
                </span>            
                 - 
                <span tal:replace="python:view.getCaptionById(term_id)"/>   
            </h2>

            <span class="discreet">
            &mdash;
            <span i18n:translate="batch_x_items_matching_your_criteria">
                <span i18n:name="number" 
                      tal:omit-tag="" 
                      tal:content="python:len(resultsByTermId)">234</span> items matching your search terms
                </span>
            </span>

            <div tal:condition="not: resultsByTermId">
                <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
            </div>

            <div tal:condition="resultsByTermId"
                 tal:define="batch python:Batch(resultsByTermId, b_size, int(b_start), orphan=1);">
            
            <dl id="db_results">
            <tal:results repeat="result batch">
            <tal:entry define="result_url result/getURL;
                               result_url string:$result_url/view;
                               url result/getRemoteUrl | result_url;
                               title result/Title|string:;
                               item_cas result/getCas|string:;
                               item_einecs result/getEinecs|string:;
                               item_remoteLanguage result/getRemoteLanguage|string:;
                               item_sme result/getSme | nothing;
                               item_provider result/Provider | string:;                           
                               item_modified result/modified;
                               item_pubdate result/effective;
                               item_creator result/Creator;
                               gc python:here.portal_languages.getNameForLanguageCode;
                               ">
    
                <dt>
                    <div tal:condition="python: result.getRemoteProviderUID and str(result.getRemoteProviderUID)!=''">
                      <span tal:define="providers python:provider_helper.getMyProviders(result)"
                         style="float: right; border: 1px solid gray; width: 30%">
                         <span i18n:translate="provider_of_information">Provider of this information:</span><br />
                        <p tal:repeat="provider providers">
                            <a href="" tal:attributes="href provider/absolute_url"><span
                                tal:replace="provider/Title"></span></a><br />
                                <img tal:replace="structure python:getattr(portal, 'link_external.gif').tag()"/>  
                                <a class="link" href="" tal:attributes="href provider/getRemoteUrl"><span 
                            i18n:translate="provider_goto_url">Go to provider's website</span></a>
                        </p>
                      </span>
                    </div>
    
                        <img tal:attributes="src string:${result/getIcon};
                                         alt string:Link icon" />
                        <span tal:replace="title" />
                            
                        <tal:notanon condition="not:isAnon">
                            [<a href="#" tal:attributes="href result_url">Edit</a>]
                        </tal:notanon>
                <div class="visualClear" ></div>
                </dt>
                     
                <dd>                              
    
                    <p tal:define="descr result/Description" 
                       tal:content="structure descr" />
    
                    <br />
                    
                    <tal:sme condition="item_sme">
                        <span class="pullquote">
                            <tal:smetrans i18n:translate="box_item_sme">
                                Relevant for SME's
                            </tal:smetrans>
                        </span>
                    </tal:sme>
    
                    <img tal:replace="structure python:getattr(portal, 'link_external.gif').tag()"/>  
                    <a href="#" tal:attributes="href url" i18n:translate="link_goto_site">
                        <strong>Goto this site</strong>
                    </a>
                    
                    <br />
                    
                    <span class="documentByLine">
                        <tal:modified>
                            <tal:mod i18n:translate="box_item_published">
                              Publication date
                            </tal:mod>
                            <span tal:replace="python:toLocalizedTime(item_pubdate, long_format=0)"
                                tal:on-error="python:toLocalizedTime('2000/01/01', long_format=0)">
                              August 16, 2001 at 23:35:59
                            </span>                        
                        </tal:modified> 
                        <tal:name tal:condition="item_provider">
                              <span i18n:translate="label_by_author">
                                by
                                  <span tal:content="item_provider"
                                        i18n:name="author">
                                    European Agency
                                  </span>
                              </span>
                        </tal:name>
                        <br tal:condition="item_einecs|item_cas"/>
                        <tal:einecs condition="item_einecs">
                            &mdash;
                            <tal:einecstrans i18n:translate="box_item_einecs">
                                EINECS: 
                            </tal:einecstrans>
                            <span tal:replace="item_einecs" />
                        </tal:einecs>
                        <tal:cas condition="item_cas">
                            &mdash;
                            <tal:castrans i18n:translate="box_item_cas">
                                 CAS:
                            </tal:castrans>
                            <span tal:replace="item_cas" />
                        </tal:cas>
                        <br tal:condition="item_remoteLanguage"/>
                        <tal:remotelanguage condition="item_remoteLanguage">
                            <tal:remotelanguagetrans i18n:translate="box_item_remotelanguage">
                                 Languages: 
                            </tal:remotelanguagetrans>
                            <span tal:repeat="lang item_remoteLanguage" tal:omit-tag="">
                                <span tal:replace="python:gc(lang)"/>
                            </span>
                        </tal:remotelanguage>       
                    </span>
                </dd>
                
            </tal:entry>
            </tal:results>
            </dl>
            
            <div metal:use-macro="here/batch_macros/macros/navigation" />
        
            </div>

        </div>

    </div>



</div>
</html>